# Python Web開発学習記録

> 日々の学習記録はdevブランチで行っており、各学習ごとの最終成果ができ次第mainに上げています。

---

## ex29_09: Simple HTTP Server in Python

Pythonのソケットプログラミングによるシンプルなサーバー実装です。GET/POSTメソッドに対応し、マルチスレッドで複数のクライアントを処理できます。

### 主な機能

- **HTTPメソッド対応**: GET / POST
- **ルーティング機能**: パスパラメータとクエリパラメータをサポート
- **静的ファイル配信**: HTML、画像、CSS、JavaScriptなどの静的ファイルを提供
- **フォームデータ処理**:
  - `application/x-www-form-urlencoded`
  - `multipart/form-data`（ファイルアップロード対応）
- **マルチスレッド対応**: 複数のクライアント接続を同時処理
- **エラーハンドリング**: 400、404、408、500エラーに対応
- **セキュリティ対策**: パストラバーサル攻撃防止、XSS対策（HTMLエスケープ）

### 技術スタック

- Python 3.x
- 標準ライブラリのみ使用（socket, threading, logging, re, urllib.parse等）

### ファイル構成

```
ex29_09/
├── ex29_09.py      # メインサーバープログラム
├── http.py         # HTTPリクエストの解析処理
├── route.py        # ルーティングとレスポンス生成
├── error.py        # エラーハンドリング
├── config.py       # サーバー設定
└── static/         # 静的ファイル格納ディレクトリ
    ├── index.html
    ├── about.html
    └── *.jpg
```

### 使い方

```bash
cd ex29_09
python3 ex29_09.py

# ブラウザでアクセス
# http://127.0.0.1:8080
```

### 実装されているエンドポイント

- `GET /` - インデックスページ
- `GET /about` - アバウトページ
- `GET /user/<user_id>` - ユーザーページ（動的パラメータ）
- `GET /search?q=keyword` - 検索ページ（クエリパラメータ）
- `POST /` - フォームデータ処理
- `GET /static/*` - 静的ファイル配信

### 技術的な特徴

#### リクエスト処理フロー
1. ソケット通信でHTTPリクエストを受信
2. ヘッダーとボディを分割してパース
3. ルーティングに基づいてハンドラー関数を実行
4. HTTPレスポンスを生成してクライアントに送信

#### マルチスレッド処理
各クライアント接続ごとに新しいスレッドを生成し、並行処理を実現しています。

#### セキュリティ対策
- 静的ファイル配信時のパストラバーサル攻撃防止
- HTMLエスケープによるXSS対策
- タイムアウト処理（30秒）

### 設定

[config.py](ex29_09/config.py)で以下の設定が可能です：

- `LOCAL_HOST`: バインドするホスト（デフォルト: 127.0.0.1）
- `PORT`: ポート番号（デフォルト: 8080）
- `TIMEOUT_INT`: タイムアウト秒数（デフォルト: 30.0）
- `BUFFER_SIZE`: バッファサイズ（デフォルト: 4096）
- `MAX_READ`: 最大読み込みサイズ（デフォルト: 10MB）

### 学んだこと

- Pythonソケットプログラミングの基礎
- HTTPプロトコルの仕組み（リクエスト/レスポンス構造）
- マルチスレッドプログラミング
- 正規表現を使ったルーティング実装
- セキュリティを考慮したWeb開発

---

## ex31_07: FastAPI + mboxメール解析

FastAPIを用いたmboxファイルのアップロード・解析APIサーバーです。

### 主な機能

- **mbox解析**: アップロードされたmboxファイルを解析し、以下の統計情報をJSON形式で返す
  - 受信回数が多いドメイン Top3
  - 受信回数が多い件名 Top3
  - 受信期間が最も長いドメイン Top3
- **一時ファイル管理**: アップロードファイルを一時ファイルに保存し、レスポンス後にバックグラウンドで削除

### 技術スタック

- Python 3.x
- FastAPI
- Pydantic（レスポンスモデル）
- mailbox / email（標準ライブラリ）

### ファイル構成

```
ex31/ex31_07/
├── ex31_07.py      # FastAPI アプリケーション
└── mbox.py         # mboxファイルの解析処理
```

### 使い方

```bash
cd ex31/ex31_07
uvicorn ex31_07:app --reload

# ブラウザでアクセス
# http://127.0.0.1:8000
```

### 実装されているエンドポイント

- `GET /` - インデックス
- `POST /mbox` - mboxファイルのアップロードと解析

### 学んだこと

- FastAPIによるREST API設計
- Pydanticを使ったレスポンスモデルのバリデーション
- `UploadFile` と `BackgroundTasks` によるファイル処理
- `tempfile` を使った安全な一時ファイル管理
- Python ファイルバッファのフラッシュタイミング
